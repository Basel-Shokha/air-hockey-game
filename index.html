<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IoT Preview - Air Hockey</title>
    <style>
        :root { --primary: #00f2ff; --bg: #0a0a0a; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        
        /* Setup Screen */
        #setup-layer { 
            position: absolute; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #1a1a1a, #000);
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 100;
        }
        .form-container { 
            background: rgba(255, 255, 255, 0.05); padding: 30px; 
            border-radius: 15px; backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 242, 255, 0.3); text-align: center;
        }
        input, select, button { 
            display: block; width: 100%; padding: 12px; margin: 15px 0; 
            border-radius: 8px; border: 1px solid #444; background: #222; color: white;
            font-size: 16px; box-sizing: border-box;
        }
        button { background: var(--primary); color: black; font-weight: bold; cursor: pointer; border: none; }

        /* Stats HUD */
        #stats-hud { 
            position: absolute; top: 20px; width: 100%; display: none; 
            justify-content: space-around; font-size: 18px; z-index: 5;
        }

        canvas { display: none; margin: auto; border-bottom: 3px solid var(--primary); }
        #led-indicator { position: absolute; top: 0; width: 100%; height: 10px; z-index: 20; }
    </style>
</head>
<body>

    <div id="led-indicator"></div>

    <div id="setup-layer">
        <div class="form-container">
            <h1 style="color: var(--primary);">IoT Preview</h1>
            <input type="text" id="pName" placeholder="Enter your name...">
            
            <label>AI Personality (Mood):</label>
            <select id="mMood">
                <option value="calm">Calm (Steady)</option>
                <option value="angry">Angry (Fast/Aggressive)</option>
                <option value="joker">Joker (Deceptive/Random)</option>
            </select>

            <label>Difficulty Level:</label>
            <select id="mDiff">
                <option value="1.5">Easy</option>
                <option value="3">Medium</option>
                <option value="6">Hard</option>
            </select>

            <button onclick="bootGame()">Initialize System</button>
        </div>
    </div>

    <div id="stats-hud">
        <div id="pLabel">Player: 0</div>
        <div id="aiLabel">AI: 0</div>
    </div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const setup = document.getElementById('setup-layer');
        const hud = document.getElementById('stats-hud');
        const led = document.getElementById('led-indicator');

        let gameState = { player: "", scoreP: 0, scoreAI: 0, mood: "", difficulty: 1 };
        let ball = { x: 0, y: 0, dx: 5, dy: 5, r: 12 };
        let p1 = { x: 0, y: 0, r: 25 };
        let ai = { x: 0, y: 0, r: 25 };

        function bootGame() {
            gameState.player = document.getElementById('pName').value || "User";
            gameState.mood = document.getElementById('mMood').value;
            gameState.difficulty = parseFloat(document.getElementById('mDiff').value);

            setup.style.display = 'none';
            hud.style.display = 'flex';
            canvas.style.display = 'block';
            
            init();
            animate();
        }

        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ball.x = canvas.width/2; ball.y = canvas.height/2;
            p1.x = canvas.width/2; p1.y = canvas.height - 100;
            ai.x = canvas.width/2; ai.y = 100;
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('pLabel').innerText = `${gameState.player}: ${gameState.scoreP}`;
            document.getElementById('aiLabel').innerText = `AI: ${gameState.scoreAI}`;
        }

        function animate() {
            ctx.fillStyle = "rgba(10, 10, 10, 0.2)"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ball.x += ball.dx; ball.y += ball.dy;
            if(ball.x < 0 || ball.x > canvas.width) ball.dx *= -1;

            // AI Logic
            let target = ball.x;
            if(gameState.mood === 'joker' && Math.random() < 0.1) target = Math.random() * canvas.width;
            let speedFactor = gameState.mood === 'angry' ? 0.25 : 0.15;
            ai.x += (target - ai.x) * speedFactor * (gameState.difficulty/2);

            // Collisions
            if(Math.hypot(ball.x - p1.x, ball.y - p1.y) < ball.r + p1.r) ball.dy = -Math.abs(ball.dy) * 1.05;
            if(Math.hypot(ball.x - ai.x, ball.y - ai.y) < ball.r + ai.r) ball.dy = Math.abs(ball.dy) * 1.05;

            // Goal Detection
            if(ball.y < 0) score('P');
            if(ball.y > canvas.height) score('AI');

            draw();
            requestAnimationFrame(animate);
        }

        function score(who) {
            if(who === 'P') { gameState.scoreP++; triggerLED("cyan"); }
            else { gameState.scoreAI++; triggerLED("red"); }
            updateHUD();
            ball.x = canvas.width/2; ball.y = canvas.height/2;
            ball.dy = who === 'P' ? 5 : -5;
        }

        function triggerLED(color) {
            led.style.background = color;
            setTimeout(() => led.style.background = "transparent", 400);
        }

        function draw() {
            ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
            ctx.fillStyle = "white"; ctx.fill(); ctx.closePath();

            drawPaddle(p1.x, p1.y, "cyan");
            drawPaddle(ai.x, ai.y, "orange");
        }

        function drawPaddle(x, y, col) {
            ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI*2);
            ctx.fillStyle = col; ctx.fill(); ctx.closePath();
        }

        window.addEventListener('touchmove', e => {
            let t = e.touches[0];
            p1.x = t.clientX;
            p1.y = Math.max(canvas.height/2 + 50, t.clientY);
        });
    </script>
</body>
</html>
